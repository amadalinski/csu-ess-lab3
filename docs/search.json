[
  {
    "objectID": "csu-ess-lab3.html",
    "href": "csu-ess-lab3.html",
    "title": "Lab 3: COVID-19",
    "section": "",
    "text": "Question 1+2: Daily Summary\n\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(flextable)\n\n\nAttaching package: 'flextable'\n\nThe following object is masked from 'package:purrr':\n\n    compose\n\nlibrary(zoo)\n\n\nAttaching package: 'zoo'\n\nThe following objects are masked from 'package:base':\n\n    as.Date, as.Date.numeric\n\nurl = 'https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv'\ncovid &lt;- read_csv(url)\n\nRows: 2502832 Columns: 6\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (3): county, state, fips\ndbl  (2): cases, deaths\ndate (1): date\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\nhead(covid, 5)\n\n# A tibble: 5 × 6\n  date       county    state      fips  cases deaths\n  &lt;date&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;\n1 2020-01-21 Snohomish Washington 53061     1      0\n2 2020-01-22 Snohomish Washington 53061     1      0\n3 2020-01-23 Snohomish Washington 53061     1      0\n4 2020-01-24 Cook      Illinois   17031     1      0\n5 2020-01-24 Snohomish Washington 53061     1      0\n\nmy.date &lt;- (\"2022-02-01\")\ndate &lt;- as.Date(my.date)\nmy.state &lt;- \"Colorado\"\n\n\ndf_co &lt;- covid |&gt;\n  filter(state == \"Colorado\") |&gt;\n  group_by(county) |&gt;\n  mutate(\n    new_cases = cases - lag(cases, default = first(cases)),\n    new_deaths = deaths - lag(deaths, default = first(deaths))\n  ) |&gt;\n  ungroup()\n\ndf_co |&gt;\n  filter(state == \"Colorado\", date == my.date) |&gt;\n  slice_max(cases, n = 5) |&gt;\n  select(Date = date, County = county, Cases = cases) |&gt;\n  flextable() |&gt;\n  set_caption(caption = \"Most Cummulative Cases in Colorado\")\n\nDateCountyCases2022-02-01El Paso170,6732022-02-01Denver159,0222022-02-01Arapahoe144,2552022-02-01Adams126,7682022-02-01Jefferson113,240\n\ndf_co |&gt;\n  filter(state == \"Colorado\", date == my.date) |&gt;\n  slice_max(cases, n = 5) |&gt;\n  select(Date = date, County = county, Cases = cases) |&gt;\n  flextable() |&gt;\n  set_caption(caption = \"Most New Cases in Colorado\")\n\nDateCountyCases2022-02-01El Paso170,6732022-02-01Denver159,0222022-02-01Arapahoe144,2552022-02-01Adams126,7682022-02-01Jefferson113,240\n\n\nQuestion 3:\n\npop_url &lt;- 'https://www2.census.gov/programs-surveys/popest/datasets/2020-2023/counties/totals/co-est2023-alldata.csv'\npop &lt;- read_csv(pop_url)\n\nRows: 3195 Columns: 67\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (5): SUMLEV, STATE, COUNTY, STNAME, CTYNAME\ndbl (62): REGION, DIVISION, ESTIMATESBASE2020, POPESTIMATE2020, POPESTIMATE2...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\npop = pop |&gt;\n  filter(COUNTY != \"000\") |&gt;\n  mutate(fips = paste0(sprintf(\"%02s\", STATE), sprintf(\"%03s\", COUNTY))) |&gt;\n  select(fips, contains(\"NAME\"), contains(\"2021\"))\n\nhead(pop)\n\n# A tibble: 6 × 19\n  fips  STNAME  CTYNAME        POPESTIMATE2021 NPOPCHG2021 BIRTHS2021 DEATHS2021\n  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;                    &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;\n1 01001 Alabama Autauga County           59203         288        686        696\n2 01003 Alabama Baldwin County          239439        6212       2337       2948\n3 01005 Alabama Barbour County           24533        -436        270        390\n4 01007 Alabama Bibb County              22359         171        240        325\n5 01009 Alabama Blount County            59079         -28        654        875\n6 01011 Alabama Bullock County           10143         -86        111        160\n# ℹ 12 more variables: NATURALCHG2021 &lt;dbl&gt;, INTERNATIONALMIG2021 &lt;dbl&gt;,\n#   DOMESTICMIG2021 &lt;dbl&gt;, NETMIG2021 &lt;dbl&gt;, RESIDUAL2021 &lt;dbl&gt;,\n#   GQESTIMATES2021 &lt;dbl&gt;, RBIRTH2021 &lt;dbl&gt;, RDEATH2021 &lt;dbl&gt;,\n#   RNATURALCHG2021 &lt;dbl&gt;, RINTERNATIONALMIG2021 &lt;dbl&gt;, RDOMESTICMIG2021 &lt;dbl&gt;,\n#   RNETMIG2021 &lt;dbl&gt;\n\n\n\n\n\n\nnames(pop)\n\n [1] \"fips\"                  \"STNAME\"                \"CTYNAME\"              \n [4] \"POPESTIMATE2021\"       \"NPOPCHG2021\"           \"BIRTHS2021\"           \n [7] \"DEATHS2021\"            \"NATURALCHG2021\"        \"INTERNATIONALMIG2021\" \n[10] \"DOMESTICMIG2021\"       \"NETMIG2021\"            \"RESIDUAL2021\"         \n[13] \"GQESTIMATES2021\"       \"RBIRTH2021\"            \"RDEATH2021\"           \n[16] \"RNATURALCHG2021\"       \"RINTERNATIONALMIG2021\" \"RDOMESTICMIG2021\"     \n[19] \"RNETMIG2021\"          \n\nglimpse(pop)\n\nRows: 3,144\nColumns: 19\n$ fips                  &lt;chr&gt; \"01001\", \"01003\", \"01005\", \"01007\", \"01009\", \"01…\n$ STNAME                &lt;chr&gt; \"Alabama\", \"Alabama\", \"Alabama\", \"Alabama\", \"Ala…\n$ CTYNAME               &lt;chr&gt; \"Autauga County\", \"Baldwin County\", \"Barbour Cou…\n$ POPESTIMATE2021       &lt;dbl&gt; 59203, 239439, 24533, 22359, 59079, 10143, 18890…\n$ NPOPCHG2021           &lt;dbl&gt; 288, 6212, -436, 171, -28, -86, -135, -565, -163…\n$ BIRTHS2021            &lt;dbl&gt; 686, 2337, 270, 240, 654, 111, 227, 1250, 392, 2…\n$ DEATHS2021            &lt;dbl&gt; 696, 2948, 390, 325, 875, 160, 297, 1843, 592, 4…\n$ NATURALCHG2021        &lt;dbl&gt; -10, -611, -120, -85, -221, -49, -70, -593, -200…\n$ INTERNATIONALMIG2021  &lt;dbl&gt; 15, 105, 0, 1, 9, 1, 5, 12, 22, 7, 20, 1, 0, -1,…\n$ DOMESTICMIG2021       &lt;dbl&gt; 242, 6972, -313, 254, 141, -42, -75, -70, -6, 28…\n$ NETMIG2021            &lt;dbl&gt; 257, 7077, -313, 255, 150, -41, -70, -58, 16, 29…\n$ RESIDUAL2021          &lt;dbl&gt; 41, -254, -3, 1, 43, 4, 5, 86, 21, 2, 18, 7, 8, …\n$ GQESTIMATES2021       &lt;dbl&gt; 484, 3351, 2248, 1994, 616, 1578, 285, 5407, 856…\n$ RBIRTH2021            &lt;dbl&gt; 11.615503, 9.888589, 10.908650, 10.775136, 11.06…\n$ RDEATH2021            &lt;dbl&gt; 11.78483, 12.47392, 15.75694, 14.59133, 14.80717…\n$ RNATURALCHG2021       &lt;dbl&gt; -0.1693222, -2.5853351, -4.8482890, -3.8161941, …\n$ RINTERNATIONALMIG2021 &lt;dbl&gt; 0.25398330, 0.44428836, 0.00000000, 0.04489640, …\n$ RDOMESTICMIG2021      &lt;dbl&gt; 4.0975973, 29.5007468, -12.6459537, 11.4036860, …\n$ RNETMIG2021           &lt;dbl&gt; 4.3515806, 29.9450352, -12.6459537, 11.4485824, …\n\nstr(pop)\n\ntibble [3,144 × 19] (S3: tbl_df/tbl/data.frame)\n $ fips                 : chr [1:3144] \"01001\" \"01003\" \"01005\" \"01007\" ...\n $ STNAME               : chr [1:3144] \"Alabama\" \"Alabama\" \"Alabama\" \"Alabama\" ...\n $ CTYNAME              : chr [1:3144] \"Autauga County\" \"Baldwin County\" \"Barbour County\" \"Bibb County\" ...\n $ POPESTIMATE2021      : num [1:3144] 59203 239439 24533 22359 59079 ...\n $ NPOPCHG2021          : num [1:3144] 288 6212 -436 171 -28 ...\n $ BIRTHS2021           : num [1:3144] 686 2337 270 240 654 ...\n $ DEATHS2021           : num [1:3144] 696 2948 390 325 875 ...\n $ NATURALCHG2021       : num [1:3144] -10 -611 -120 -85 -221 -49 -70 -593 -200 -188 ...\n $ INTERNATIONALMIG2021 : num [1:3144] 15 105 0 1 9 1 5 12 22 7 ...\n $ DOMESTICMIG2021      : num [1:3144] 242 6972 -313 254 141 ...\n $ NETMIG2021           : num [1:3144] 257 7077 -313 255 150 ...\n $ RESIDUAL2021         : num [1:3144] 41 -254 -3 1 43 4 5 86 21 2 ...\n $ GQESTIMATES2021      : num [1:3144] 484 3351 2248 1994 616 ...\n $ RBIRTH2021           : num [1:3144] 11.62 9.89 10.91 10.78 11.07 ...\n $ RDEATH2021           : num [1:3144] 11.8 12.5 15.8 14.6 14.8 ...\n $ RNATURALCHG2021      : num [1:3144] -0.169 -2.585 -4.848 -3.816 -3.74 ...\n $ RINTERNATIONALMIG2021: num [1:3144] 0.254 0.4443 0 0.0449 0.1523 ...\n $ RDOMESTICMIG2021     : num [1:3144] 4.1 29.5 -12.65 11.4 2.39 ...\n $ RNETMIG2021          : num [1:3144] 4.35 29.95 -12.65 11.45 2.54 ...\n\n\nThere are 67 different columns with 3,195 rows. Most of the variables are doubles, with 5 character variables. The columns that match the COVID data are state and county. There are also death columns in the pop data, however they are divided by year while the deaths column in the COVID data is added together.\n\n\n\n\npop |&gt;\nfilter(STNAME == \"Colorado\")\n\n# A tibble: 64 × 19\n   fips  STNAME   CTYNAME      POPESTIMATE2021 NPOPCHG2021 BIRTHS2021 DEATHS2021\n   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;                  &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;\n 1 08001 Colorado Adams County          523544        3044       6631       3869\n 2 08003 Colorado Alamosa Cou…           16579         202        192        166\n 3 08005 Colorado Arapahoe Co…          656855        1583       7592       4703\n 4 08007 Colorado Archuleta C…           13806         382        119        126\n 5 08009 Colorado Baca County             3490          10         35         72\n 6 08011 Colorado Bent County             5339        -134         36         77\n 7 08013 Colorado Boulder Cou…          327084       -3854       2481       2144\n 8 08014 Colorado Broomfield …           75411         921        654        452\n 9 08015 Colorado Chaffee Cou…           19741         257        149        172\n10 08017 Colorado Cheyenne Co…            1719         -27         21         24\n# ℹ 54 more rows\n# ℹ 12 more variables: NATURALCHG2021 &lt;dbl&gt;, INTERNATIONALMIG2021 &lt;dbl&gt;,\n#   DOMESTICMIG2021 &lt;dbl&gt;, NETMIG2021 &lt;dbl&gt;, RESIDUAL2021 &lt;dbl&gt;,\n#   GQESTIMATES2021 &lt;dbl&gt;, RBIRTH2021 &lt;dbl&gt;, RDEATH2021 &lt;dbl&gt;,\n#   RNATURALCHG2021 &lt;dbl&gt;, RINTERNATIONALMIG2021 &lt;dbl&gt;, RDOMESTICMIG2021 &lt;dbl&gt;,\n#   RNETMIG2021 &lt;dbl&gt;\n\nrange(pop$POPESTIMATE2021, na.rm = TRUE)\n\n[1]      54 9809462\n\n\nThe minimum population of a Colorado county in 2021 was 54 and the maximum was 9,809,462.\npart 4.\n\njoined &lt;- df_co |&gt;\n  inner_join(pop, by = \"fips\")\n\njoined &lt;- joined |&gt;\n  mutate(\n    per_capita_new_cases = new_cases / POPESTIMATE2021,\n    per_capita_new_deaths = new_deaths / POPESTIMATE2021,\n    per_capita_cummulative_cases = cases / POPESTIMATE2021\n  ) |&gt;\n  drop_na()\n\nQuestion 3, part 5\n\nTop5_Cummulative_Cases &lt;- joined |&gt;\n  filter(date == \"2021-01-01\") |&gt;\n  arrange(desc(per_capita_cummulative_cases)) |&gt;\n  head(5)\n\nflextable::flextable(\n  Top5_Cummulative_Cases,\n  col_keys = names(Top5_Cummulative_Cases),\n  cwidth = .75,\n  cheight = .25,\n  defaults = list(),\n  theme_fun = theme_booktabs(),\n  use_labels = TRUE\n)\n\ndatecountystatefipscasesdeathsnew_casesnew_deathsSTNAMECTYNAMEPOPESTIMATE2021NPOPCHG2021BIRTHS2021DEATHS2021NATURALCHG2021INTERNATIONALMIG2021DOMESTICMIG2021NETMIG2021RESIDUAL2021GQESTIMATES2021RBIRTH2021RDEATH2021RNATURALCHG2021RINTERNATIONALMIG2021RDOMESTICMIG2021RNETMIG2021per_capita_new_casesper_capita_new_deathsper_capita_cummulative_cases2021-01-01CrowleyColorado080251,66012130ColoradoCrowley County5,735473065-35-18786-42,6095.25256111.38055-6.127987-0.175085415.2324315.0573400.00226678290.000000000000.289450742021-01-01BentColorado080111,12612890ColoradoBent County5,339-1343677-410-84-84-91,1736.65926714.24343-7.5841660.0000000-15.53829-15.5382910.01666978830.000000000000.210900922021-01-01LoganColorado080753,24955111ColoradoLogan County21,006-204188307-1197-100-9382,6958.90657614.54425-5.6376730.3316278-4.73754-4.4059120.00052365990.000047605450.154670092021-01-01LincolnColorado080737833-120ColoradoLincoln County5,473-1894062-222-159-157-107847.18455311.13606-3.9515040.3592277-28.55860-28.199371-0.00219258180.000000000000.143065962021-01-01FremontColorado080434,68120191ColoradoFremont County49,237359383680-2977653660-47,5687.80716513.86129-6.0541200.142689713.3109113.4536000.00038588870.000020309930.09507078\n\n\nQuestion 4:\n\nlatest_date &lt;- max(df_co$date, na.rm = TRUE)\nstart_date &lt;- latest_date - 14\n\nlast14days &lt;- joined %&gt;%\n  filter(date &gt;= start_date)\n\nlast14days_data &lt;- last14days %&gt;%\n  group_by(county) %&gt;%\n  summarise(\n    total_new_cases = sum(new_cases, na.rm = TRUE),\n    total_population = first(POPESTIMATE2021),\n    new_cases_per_100k = (total_new_cases / total_population)*100000) %&gt;%\n  arrange(desc(new_cases_per_100k))\n\n\ntop_5_counties &lt;- head(last14days_data, 5)\n  \nprint(top_5_counties)\n\n# A tibble: 5 × 4\n  county    total_new_cases total_population new_cases_per_100k\n  &lt;chr&gt;               &lt;dbl&gt;            &lt;dbl&gt;              &lt;dbl&gt;\n1 Mineral                 8              929               861.\n2 Boulder              2685           327084               821.\n3 Larimer              2027           362747               559.\n4 Denver               3968           711467               558.\n5 Jefferson            2728           580703               470.\n\ncount_watch_list &lt;- sum(last14days_data$new_cases_per_100k&gt; 100)\n\n56 different counties meet the watch list condition of more than 100 new cases per 100,000 residents over the past 14 days.\nQuestion 5:\n\ncolorado_2021 &lt;- df_co |&gt;\n  filter(format(date, \"%Y\") == \"2021\") |&gt;\n  group_by(fips) |&gt;\n  summarize(total_covid_deaths = sum(deaths, na.rm = TRUE))\n\ncounty_deaths &lt;- colorado_2021 |&gt;\n  inner_join(pop, by = \"fips\") |&gt;\n  mutate(covid_death_percent = (total_covid_deaths / POPESTIMATE2021) * 100)\n\nhigh_covid_death_counties &lt;- county_deaths |&gt;\n  filter(covid_death_percent &gt;= 20)\n\nggplot(high_covid_death_counties, aes(x = reorder(fips, -covid_death_percent), y = covid_death_percent)) +\n  geom_bar(stat = \"identity\", fill = \"skyblue\") +\n  labs(\n    title = \"Colorado Counties with 20% or More Deaths Attributed to COVID in 2021\",\n    x = \"County\",\n    y = \"Percent Deaths Attributed to COVID\"\n  )\n\n\n\n\n\n\n\n\nQuestion 6:\n\nstate_covid &lt;- covid |&gt;\n  group_by(date, state) |&gt;\n  summarize(cases = sum(cases)) |&gt;\n  filter(state %in% c(\"New York\", \"Ohio\", \"Colorado\", \"Alabama\")) |&gt;\n  group_by(state) |&gt;\n  mutate(NewCases = cases - lag(cases),\n         roll = zoo:: rollmean(NewCases, k = 7, align = \"right\", fill = NA)) |&gt;\n  ungroup()\n\n`summarise()` has grouped output by 'date'. You can override using the\n`.groups` argument.\n\nggplot(state_covid, aes(x = date)) +\n  geom_col(aes(y = NewCases), fill = \"pink\", col = NA) +\n  geom_line(aes(y = roll), col = \"darkred\", size = 1) +\n  theme_linedraw() +\n  facet_wrap(~state, nrow = 2, scales = \"free_y\") +\n  labs(\n    title = \"CUmmulative COVID-19 Cases\",\n    x = \"Date\", y = \"Cases Count\"\n  )\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n\n\nWarning: Removed 4 rows containing missing values or values outside the scale range\n(`geom_col()`).\n\n\nWarning: Removed 7 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n\nQuestion 6 cont.\n\npp = pop |&gt;\n  group_by(STNAME) |&gt;\n  summarise(state_pop = sum(POPESTIMATE2021)) |&gt;\n  inner_join(state_covid, by = c(\"STNAME\" = \"state\")) |&gt;\n  mutate(perCap = NewCases / state_pop) |&gt;\n  group_by(STNAME) |&gt;\n  mutate(roll = zoo::rollmean(perCap, k = 7, align = \"right\", fill = NA)) |&gt;\n  ungroup()\n\nggplot(pp, aes(x = date)) +\n  geom_line(aes(y = roll, col = STNAME), size = 1) +\n  theme_linedraw() +\n  labs(\n    title = \"Cummulative COVID-19 Cases\",\n    x = \"Date\", y = \"Case Count\"\n  )\n\nWarning: Removed 28 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n\nScaling the data made the bigger states look better, as it showed that their inevitably higher case count was more in proportion with their population. It made the smaller states look worse, as before their cases counts looked extremely small compared to the bigger states, however scaling the data showed that their proportions were similar to the bigger states.\nQuestion 7\n\nmeta = read_csv(\"https://raw.githubusercontent.com/mikejohnson51/csu-ess-330/refs/heads/main/resources/county-centroids.csv\") |&gt;\n  inner_join(covid) |&gt;\n  group_by(date) |&gt;\n  summarise(wmX_c = sum(LON*cases) / sum(cases),\n            wmY_c = sum(LAT*cases) / sum(cases),\n            cases = sum(cases)) |&gt;\n  arrange(date) |&gt;\n  mutate(d = 1:n()) \n\nRows: 3221 Columns: 3\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): fips\ndbl (2): LON, LAT\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\nJoining with `by = join_by(fips)`\n\nggplot(meta) +\n  borders(\"state\", fill = \"grey\", colour = \"white\") +\n  geom_point(aes(x = wmX_c, y = wmY_c, linewidth = cases),\n             color = \"red\", alpha = .25) +\n  theme_linedraw() +\n  labs(color = \"Time\",\n       size = \"Cases\",\n       x = \"\", y = \"\",\n       title = \"Weighted Center of COVID-19 Cases\") +\n  theme(legend.position = \"none\")\n\nWarning in geom_point(aes(x = wmX_c, y = wmY_c, linewidth = cases), color =\n\"red\", : Ignoring unknown aesthetics: linewidth\n\n\n\n\n\n\n\n\nborders(\"state\", fill = \"grey\", colour = \"white\")\n\nmapping: group = ~group, x = ~long, y = ~lat \ngeom_polygon: na.rm = FALSE, rule = evenodd\nstat_identity: na.rm = FALSE\nposition_identity \n\n\nThe movement of the weighted center of COVID data goes from west to east. I know that the first hot spot was right outside of Seattle, so it makes sense that the first point is here. As COVID continue, the weighted center moves towards the middle, as cases in every state started to rise. It is skewed a bit to the east, which means sense as there is denser population on the east coast compared to the west, so there would be a higher proportion of cases there.\nQuestion 8:"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Lab 3: COVID-19",
    "section": "",
    "text": "Question 1+2: Daily Summary\n\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(flextable)\n\n\nAttaching package: 'flextable'\n\nThe following object is masked from 'package:purrr':\n\n    compose\n\nlibrary(zoo)\n\n\nAttaching package: 'zoo'\n\nThe following objects are masked from 'package:base':\n\n    as.Date, as.Date.numeric\n\nurl = 'https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv'\ncovid &lt;- read_csv(url)\n\nRows: 2502832 Columns: 6\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (3): county, state, fips\ndbl  (2): cases, deaths\ndate (1): date\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\nhead(covid, 5)\n\n# A tibble: 5 × 6\n  date       county    state      fips  cases deaths\n  &lt;date&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;\n1 2020-01-21 Snohomish Washington 53061     1      0\n2 2020-01-22 Snohomish Washington 53061     1      0\n3 2020-01-23 Snohomish Washington 53061     1      0\n4 2020-01-24 Cook      Illinois   17031     1      0\n5 2020-01-24 Snohomish Washington 53061     1      0\n\nmy.date &lt;- (\"2022-02-01\")\ndate &lt;- as.Date(my.date)\nmy.state &lt;- \"Colorado\"\n\n\ndf_co &lt;- covid |&gt;\n  filter(state == \"Colorado\") |&gt;\n  group_by(county) |&gt;\n  mutate(\n    new_cases = cases - lag(cases, default = first(cases)),\n    new_deaths = deaths - lag(deaths, default = first(deaths))\n  ) |&gt;\n  ungroup()\n\ndf_co |&gt;\n  filter(state == \"Colorado\", date == my.date) |&gt;\n  slice_max(cases, n = 5) |&gt;\n  select(Date = date, County = county, Cases = cases) |&gt;\n  flextable() |&gt;\n  set_caption(caption = \"Most Cummulative Cases in Colorado\")\n\nDateCountyCases2022-02-01El Paso170,6732022-02-01Denver159,0222022-02-01Arapahoe144,2552022-02-01Adams126,7682022-02-01Jefferson113,240\n\ndf_co |&gt;\n  filter(state == \"Colorado\", date == my.date) |&gt;\n  slice_max(cases, n = 5) |&gt;\n  select(Date = date, County = county, Cases = cases) |&gt;\n  flextable() |&gt;\n  set_caption(caption = \"Most New Cases in Colorado\")\n\nDateCountyCases2022-02-01El Paso170,6732022-02-01Denver159,0222022-02-01Arapahoe144,2552022-02-01Adams126,7682022-02-01Jefferson113,240\n\n\nQuestion 3:\n\npop_url &lt;- 'https://www2.census.gov/programs-surveys/popest/datasets/2020-2023/counties/totals/co-est2023-alldata.csv'\npop &lt;- read_csv(pop_url)\n\nRows: 3195 Columns: 67\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (5): SUMLEV, STATE, COUNTY, STNAME, CTYNAME\ndbl (62): REGION, DIVISION, ESTIMATESBASE2020, POPESTIMATE2020, POPESTIMATE2...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\npop = pop |&gt;\n  filter(COUNTY != \"000\") |&gt;\n  mutate(fips = paste0(sprintf(\"%02s\", STATE), sprintf(\"%03s\", COUNTY))) |&gt;\n  select(fips, contains(\"NAME\"), contains(\"2021\"))\n\nhead(pop)\n\n# A tibble: 6 × 19\n  fips  STNAME  CTYNAME        POPESTIMATE2021 NPOPCHG2021 BIRTHS2021 DEATHS2021\n  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;                    &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;\n1 01001 Alabama Autauga County           59203         288        686        696\n2 01003 Alabama Baldwin County          239439        6212       2337       2948\n3 01005 Alabama Barbour County           24533        -436        270        390\n4 01007 Alabama Bibb County              22359         171        240        325\n5 01009 Alabama Blount County            59079         -28        654        875\n6 01011 Alabama Bullock County           10143         -86        111        160\n# ℹ 12 more variables: NATURALCHG2021 &lt;dbl&gt;, INTERNATIONALMIG2021 &lt;dbl&gt;,\n#   DOMESTICMIG2021 &lt;dbl&gt;, NETMIG2021 &lt;dbl&gt;, RESIDUAL2021 &lt;dbl&gt;,\n#   GQESTIMATES2021 &lt;dbl&gt;, RBIRTH2021 &lt;dbl&gt;, RDEATH2021 &lt;dbl&gt;,\n#   RNATURALCHG2021 &lt;dbl&gt;, RINTERNATIONALMIG2021 &lt;dbl&gt;, RDOMESTICMIG2021 &lt;dbl&gt;,\n#   RNETMIG2021 &lt;dbl&gt;\n\n\npart 2.\n\nnames(pop)\n\n [1] \"fips\"                  \"STNAME\"                \"CTYNAME\"              \n [4] \"POPESTIMATE2021\"       \"NPOPCHG2021\"           \"BIRTHS2021\"           \n [7] \"DEATHS2021\"            \"NATURALCHG2021\"        \"INTERNATIONALMIG2021\" \n[10] \"DOMESTICMIG2021\"       \"NETMIG2021\"            \"RESIDUAL2021\"         \n[13] \"GQESTIMATES2021\"       \"RBIRTH2021\"            \"RDEATH2021\"           \n[16] \"RNATURALCHG2021\"       \"RINTERNATIONALMIG2021\" \"RDOMESTICMIG2021\"     \n[19] \"RNETMIG2021\"          \n\nglimpse(pop)\n\nRows: 3,144\nColumns: 19\n$ fips                  &lt;chr&gt; \"01001\", \"01003\", \"01005\", \"01007\", \"01009\", \"01…\n$ STNAME                &lt;chr&gt; \"Alabama\", \"Alabama\", \"Alabama\", \"Alabama\", \"Ala…\n$ CTYNAME               &lt;chr&gt; \"Autauga County\", \"Baldwin County\", \"Barbour Cou…\n$ POPESTIMATE2021       &lt;dbl&gt; 59203, 239439, 24533, 22359, 59079, 10143, 18890…\n$ NPOPCHG2021           &lt;dbl&gt; 288, 6212, -436, 171, -28, -86, -135, -565, -163…\n$ BIRTHS2021            &lt;dbl&gt; 686, 2337, 270, 240, 654, 111, 227, 1250, 392, 2…\n$ DEATHS2021            &lt;dbl&gt; 696, 2948, 390, 325, 875, 160, 297, 1843, 592, 4…\n$ NATURALCHG2021        &lt;dbl&gt; -10, -611, -120, -85, -221, -49, -70, -593, -200…\n$ INTERNATIONALMIG2021  &lt;dbl&gt; 15, 105, 0, 1, 9, 1, 5, 12, 22, 7, 20, 1, 0, -1,…\n$ DOMESTICMIG2021       &lt;dbl&gt; 242, 6972, -313, 254, 141, -42, -75, -70, -6, 28…\n$ NETMIG2021            &lt;dbl&gt; 257, 7077, -313, 255, 150, -41, -70, -58, 16, 29…\n$ RESIDUAL2021          &lt;dbl&gt; 41, -254, -3, 1, 43, 4, 5, 86, 21, 2, 18, 7, 8, …\n$ GQESTIMATES2021       &lt;dbl&gt; 484, 3351, 2248, 1994, 616, 1578, 285, 5407, 856…\n$ RBIRTH2021            &lt;dbl&gt; 11.615503, 9.888589, 10.908650, 10.775136, 11.06…\n$ RDEATH2021            &lt;dbl&gt; 11.78483, 12.47392, 15.75694, 14.59133, 14.80717…\n$ RNATURALCHG2021       &lt;dbl&gt; -0.1693222, -2.5853351, -4.8482890, -3.8161941, …\n$ RINTERNATIONALMIG2021 &lt;dbl&gt; 0.25398330, 0.44428836, 0.00000000, 0.04489640, …\n$ RDOMESTICMIG2021      &lt;dbl&gt; 4.0975973, 29.5007468, -12.6459537, 11.4036860, …\n$ RNETMIG2021           &lt;dbl&gt; 4.3515806, 29.9450352, -12.6459537, 11.4485824, …\n\nstr(pop)\n\ntibble [3,144 × 19] (S3: tbl_df/tbl/data.frame)\n $ fips                 : chr [1:3144] \"01001\" \"01003\" \"01005\" \"01007\" ...\n $ STNAME               : chr [1:3144] \"Alabama\" \"Alabama\" \"Alabama\" \"Alabama\" ...\n $ CTYNAME              : chr [1:3144] \"Autauga County\" \"Baldwin County\" \"Barbour County\" \"Bibb County\" ...\n $ POPESTIMATE2021      : num [1:3144] 59203 239439 24533 22359 59079 ...\n $ NPOPCHG2021          : num [1:3144] 288 6212 -436 171 -28 ...\n $ BIRTHS2021           : num [1:3144] 686 2337 270 240 654 ...\n $ DEATHS2021           : num [1:3144] 696 2948 390 325 875 ...\n $ NATURALCHG2021       : num [1:3144] -10 -611 -120 -85 -221 -49 -70 -593 -200 -188 ...\n $ INTERNATIONALMIG2021 : num [1:3144] 15 105 0 1 9 1 5 12 22 7 ...\n $ DOMESTICMIG2021      : num [1:3144] 242 6972 -313 254 141 ...\n $ NETMIG2021           : num [1:3144] 257 7077 -313 255 150 ...\n $ RESIDUAL2021         : num [1:3144] 41 -254 -3 1 43 4 5 86 21 2 ...\n $ GQESTIMATES2021      : num [1:3144] 484 3351 2248 1994 616 ...\n $ RBIRTH2021           : num [1:3144] 11.62 9.89 10.91 10.78 11.07 ...\n $ RDEATH2021           : num [1:3144] 11.8 12.5 15.8 14.6 14.8 ...\n $ RNATURALCHG2021      : num [1:3144] -0.169 -2.585 -4.848 -3.816 -3.74 ...\n $ RINTERNATIONALMIG2021: num [1:3144] 0.254 0.4443 0 0.0449 0.1523 ...\n $ RDOMESTICMIG2021     : num [1:3144] 4.1 29.5 -12.65 11.4 2.39 ...\n $ RNETMIG2021          : num [1:3144] 4.35 29.95 -12.65 11.45 2.54 ...\n\n\nThere are 67 different columns with 3,195 rows. Most of the variables are doubles, with 5 character variables. The columns that match the COVID data are state and county. There are also death columns in the pop data, however they are divided by year while the deaths column in the COVID data is added together.\npart 3.\n\npop |&gt;\nfilter(STNAME == \"Colorado\")\n\n# A tibble: 64 × 19\n   fips  STNAME   CTYNAME      POPESTIMATE2021 NPOPCHG2021 BIRTHS2021 DEATHS2021\n   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;                  &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;\n 1 08001 Colorado Adams County          523544        3044       6631       3869\n 2 08003 Colorado Alamosa Cou…           16579         202        192        166\n 3 08005 Colorado Arapahoe Co…          656855        1583       7592       4703\n 4 08007 Colorado Archuleta C…           13806         382        119        126\n 5 08009 Colorado Baca County             3490          10         35         72\n 6 08011 Colorado Bent County             5339        -134         36         77\n 7 08013 Colorado Boulder Cou…          327084       -3854       2481       2144\n 8 08014 Colorado Broomfield …           75411         921        654        452\n 9 08015 Colorado Chaffee Cou…           19741         257        149        172\n10 08017 Colorado Cheyenne Co…            1719         -27         21         24\n# ℹ 54 more rows\n# ℹ 12 more variables: NATURALCHG2021 &lt;dbl&gt;, INTERNATIONALMIG2021 &lt;dbl&gt;,\n#   DOMESTICMIG2021 &lt;dbl&gt;, NETMIG2021 &lt;dbl&gt;, RESIDUAL2021 &lt;dbl&gt;,\n#   GQESTIMATES2021 &lt;dbl&gt;, RBIRTH2021 &lt;dbl&gt;, RDEATH2021 &lt;dbl&gt;,\n#   RNATURALCHG2021 &lt;dbl&gt;, RINTERNATIONALMIG2021 &lt;dbl&gt;, RDOMESTICMIG2021 &lt;dbl&gt;,\n#   RNETMIG2021 &lt;dbl&gt;\n\nrange(pop$POPESTIMATE2021, na.rm = TRUE)\n\n[1]      54 9809462\n\n\nThe minimum population of a Colorado county in 2021 was 54 and the maximum was 9,809,462.\npart 4.\n\njoined &lt;- df_co |&gt;\n  inner_join(pop, by = \"fips\")\n\njoined &lt;- joined |&gt;\n  mutate(\n    per_capita_new_cases = new_cases / POPESTIMATE2021,\n    per_capita_new_deaths = new_deaths / POPESTIMATE2021,\n    per_capita_cummulative_cases = cases / POPESTIMATE2021\n  ) |&gt;\n  drop_na()\n\nQuestion 3, part 5\n\nTop5_Cummulative_Cases &lt;- joined |&gt;\n  filter(date == \"2021-01-01\") |&gt;\n  arrange(desc(per_capita_cummulative_cases)) |&gt;\n  head(5)\n\nflextable::flextable(\n  Top5_Cummulative_Cases,\n  col_keys = names(Top5_Cummulative_Cases),\n  cwidth = .75,\n  cheight = .25,\n  defaults = list(),\n  theme_fun = theme_booktabs(),\n  use_labels = TRUE\n)\n\ndatecountystatefipscasesdeathsnew_casesnew_deathsSTNAMECTYNAMEPOPESTIMATE2021NPOPCHG2021BIRTHS2021DEATHS2021NATURALCHG2021INTERNATIONALMIG2021DOMESTICMIG2021NETMIG2021RESIDUAL2021GQESTIMATES2021RBIRTH2021RDEATH2021RNATURALCHG2021RINTERNATIONALMIG2021RDOMESTICMIG2021RNETMIG2021per_capita_new_casesper_capita_new_deathsper_capita_cummulative_cases2021-01-01CrowleyColorado080251,66012130ColoradoCrowley County5,735473065-35-18786-42,6095.25256111.38055-6.127987-0.175085415.2324315.0573400.00226678290.000000000000.289450742021-01-01BentColorado080111,12612890ColoradoBent County5,339-1343677-410-84-84-91,1736.65926714.24343-7.5841660.0000000-15.53829-15.5382910.01666978830.000000000000.210900922021-01-01LoganColorado080753,24955111ColoradoLogan County21,006-204188307-1197-100-9382,6958.90657614.54425-5.6376730.3316278-4.73754-4.4059120.00052365990.000047605450.154670092021-01-01LincolnColorado080737833-120ColoradoLincoln County5,473-1894062-222-159-157-107847.18455311.13606-3.9515040.3592277-28.55860-28.199371-0.00219258180.000000000000.143065962021-01-01FremontColorado080434,68120191ColoradoFremont County49,237359383680-2977653660-47,5687.80716513.86129-6.0541200.142689713.3109113.4536000.00038588870.000020309930.09507078\n\n\nQuestion 4:\n\nlatest_date &lt;- max(df_co$date, na.rm = TRUE)\nstart_date &lt;- latest_date - 14\n\nlast14days &lt;- joined %&gt;%\n  filter(date &gt;= start_date)\n\nlast14days_data &lt;- last14days %&gt;%\n  group_by(county) %&gt;%\n  summarise(\n    total_new_cases = sum(new_cases, na.rm = TRUE),\n    total_population = first(POPESTIMATE2021),\n    new_cases_per_100k = (total_new_cases / total_population)*100000) %&gt;%\n  arrange(desc(new_cases_per_100k))\n\n\ntop_5_counties &lt;- head(last14days_data, 5)\n  \nprint(top_5_counties)\n\n# A tibble: 5 × 4\n  county    total_new_cases total_population new_cases_per_100k\n  &lt;chr&gt;               &lt;dbl&gt;            &lt;dbl&gt;              &lt;dbl&gt;\n1 Mineral                 8              929               861.\n2 Boulder              2685           327084               821.\n3 Larimer              2027           362747               559.\n4 Denver               3968           711467               558.\n5 Jefferson            2728           580703               470.\n\ncount_watch_list &lt;- sum(last14days_data$new_cases_per_100k&gt; 100)\n\n56 different counties meet the watch list condition of more than 100 new cases per 100,000 residents over the past 14 days.\nQuestion 5:\n\ncolorado_2021 &lt;- df_co |&gt;\n  filter(format(date, \"%Y\") == \"2021\") |&gt;\n  group_by(fips) |&gt;\n  summarize(total_covid_deaths = sum(deaths, na.rm = TRUE))\n\ncounty_deaths &lt;- colorado_2021 |&gt;\n  inner_join(pop, by = \"fips\") |&gt;\n  mutate(covid_death_percent = (total_covid_deaths / POPESTIMATE2021) * 100)\n\nhigh_covid_death_counties &lt;- county_deaths |&gt;\n  filter(covid_death_percent &gt;= 20)\n\nggplot(high_covid_death_counties, aes(x = reorder(fips, -covid_death_percent), y = covid_death_percent)) +\n  geom_bar(stat = \"identity\", fill = \"skyblue\") +\n  labs(\n    title = \"Colorado Counties with 20% or More Deaths Attributed to COVID in 2021\",\n    x = \"County\",\n    y = \"Percent Deaths Attributed to COVID\"\n  )\n\n\n\n\n\n\n\n\nQuestion 6:\n\nstate_covid &lt;- covid |&gt;\n  group_by(date, state) |&gt;\n  summarize(cases = sum(cases)) |&gt;\n  filter(state %in% c(\"New York\", \"Ohio\", \"Colorado\", \"Alabama\")) |&gt;\n  group_by(state) |&gt;\n  mutate(NewCases = cases - lag(cases),\n         roll = zoo:: rollmean(NewCases, k = 7, align = \"right\", fill = NA)) |&gt;\n  ungroup()\n\n`summarise()` has grouped output by 'date'. You can override using the\n`.groups` argument.\n\nggplot(state_covid, aes(x = date)) +\n  geom_col(aes(y = NewCases), fill = \"pink\", col = NA) +\n  geom_line(aes(y = roll), col = \"darkred\", size = 1) +\n  theme_linedraw() +\n  facet_wrap(~state, nrow = 2, scales = \"free_y\") +\n  labs(\n    title = \"CUmmulative COVID-19 Cases\",\n    x = \"Date\", y = \"Cases Count\"\n  )\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n\n\nWarning: Removed 4 rows containing missing values or values outside the scale range\n(`geom_col()`).\n\n\nWarning: Removed 7 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n\nQuestion 6 cont.\n\npp = pop |&gt;\n  group_by(STNAME) |&gt;\n  summarise(state_pop = sum(POPESTIMATE2021)) |&gt;\n  inner_join(state_covid, by = c(\"STNAME\" = \"state\")) |&gt;\n  mutate(perCap = NewCases / state_pop) |&gt;\n  group_by(STNAME) |&gt;\n  mutate(roll = zoo::rollmean(perCap, k = 7, align = \"right\", fill = NA)) |&gt;\n  ungroup()\n\nggplot(pp, aes(x = date)) +\n  geom_line(aes(y = roll, col = STNAME), size = 1) +\n  theme_linedraw() +\n  labs(\n    title = \"Cummulative COVID-19 Cases\",\n    x = \"Date\", y = \"Case Count\"\n  )\n\nWarning: Removed 28 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n\nScaling the data made the bigger states look better, as it showed that their inevitably higher case count was more in proportion with their population. It made the smaller states look worse, as before their cases counts looked extremely small compared to the bigger states, however scaling the data showed that their proportions were similar to the bigger states.\nQuestion 7\n\nmeta = read_csv(\"https://raw.githubusercontent.com/mikejohnson51/csu-ess-330/refs/heads/main/resources/county-centroids.csv\") |&gt;\n  inner_join(covid) |&gt;\n  group_by(date) |&gt;\n  summarise(wmX_c = sum(LON*cases) / sum(cases),\n            wmY_c = sum(LAT*cases) / sum(cases),\n            cases = sum(cases)) |&gt;\n  arrange(date) |&gt;\n  mutate(d = 1:n()) \n\nRows: 3221 Columns: 3\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): fips\ndbl (2): LON, LAT\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\nJoining with `by = join_by(fips)`\n\nggplot(meta) +\n  borders(\"state\", fill = \"grey\", colour = \"white\") +\n  geom_point(aes(x = wmX_c, y = wmY_c, linewidth = cases),\n             color = \"red\", alpha = .25) +\n  theme_linedraw() +\n  labs(color = \"Time\",\n       size = \"Cases\",\n       x = \"\", y = \"\",\n       title = \"Weighted Center of COVID-19 Cases\") +\n  theme(legend.position = \"none\")\n\nWarning in geom_point(aes(x = wmX_c, y = wmY_c, linewidth = cases), color =\n\"red\", : Ignoring unknown aesthetics: linewidth\n\n\n\n\n\n\n\n\nborders(\"state\", fill = \"grey\", colour = \"white\")\n\nmapping: group = ~group, x = ~long, y = ~lat \ngeom_polygon: na.rm = FALSE, rule = evenodd\nstat_identity: na.rm = FALSE\nposition_identity \n\n\nThe movement of the weighted center of COVID data goes from west to east. I know that the first hot spot was right outside of Seattle, so it makes sense that the first point is here. As COVID continue, the weighted center moves towards the middle, as cases in every state started to rise. It is skewed a bit to the east, which means sense as there is denser population on the east coast compared to the west, so there would be a higher proportion of cases there."
  }
]